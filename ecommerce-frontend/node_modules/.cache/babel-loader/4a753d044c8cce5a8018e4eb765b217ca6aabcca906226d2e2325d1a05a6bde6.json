{"ast":null,"code":"import axios from 'axios';\nimport http, { API_BASE_URL, normalizeHttpError } from '../http';\nconst AUTH_PREFIX = '/api/v1/user';\nconst CSRF_STORAGE_KEY = 'auth.csrfToken';\nexport async function login(credentials) {\n  const payload = normalizeLoginPayload(credentials);\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/login`, payload, {\n      skipAuthRefresh: true\n    });\n    return normalizeAuthResponse(data);\n  } catch (error) {\n    throw normalizeHttpError(error, '登录失败，请检查账号信息。');\n  }\n}\nexport async function register(payload) {\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/register`, payload, {\n      skipAuthRefresh: true\n    });\n    return normalizeAuthResponse(data);\n  } catch (error) {\n    throw normalizeHttpError(error, '注册失败，请稍后再试。');\n  }\n}\nexport async function logout() {\n  try {\n    await http.post(`${AUTH_PREFIX}/logout`);\n  } catch (error) {\n    throw normalizeHttpError(error, '退出登录失败，请稍后再试。');\n  }\n  localStorage.removeItem(CSRF_STORAGE_KEY);\n}\nexport async function refreshToken(refreshToken) {\n  try {\n    const response = await axios.post(`${API_BASE_URL}${AUTH_PREFIX}/token/refresh`, {\n      refreshToken\n    }, {\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      timeout: 8000\n    });\n    return normalizeAuthResponse(response.data);\n  } catch (error) {\n    throw normalizeHttpError(error, '刷新登录状态失败，请重新登录。');\n  }\n}\nfunction normalizeAuthResponse(data = {}) {\n  const payload = data && typeof data === 'object' && typeof data.data === 'object' ? data.data : data;\n  const token = payload.token || payload.accessToken || payload.access_token || data.token || null;\n  const refreshToken = payload.refreshToken || payload.refresh_token || data.refreshToken || null;\n  const expiresIn = payload.expiresIn || payload.expires_in || data.expiresIn || null;\n  const csrfToken = payload.csrfToken || payload.csrf_token || data.csrfToken || null;\n  const user = payload.user || data.user || null;\n  const expiresAt = payload.expiresAt ? Number(payload.expiresAt) : expiresIn ? Date.now() + Number(expiresIn) * 1000 : null;\n  if (csrfToken) {\n    try {\n      localStorage.setItem(CSRF_STORAGE_KEY, csrfToken);\n    } catch (error) {\n      console.warn('[authAPI] 存储 CSRF 令牌失败:', error);\n    }\n  }\n  return {\n    token,\n    refreshToken,\n    expiresAt,\n    user,\n    raw: data\n  };\n}\nfunction normalizeLoginPayload(credentials = {}) {\n  const payload = {\n    ...credentials\n  };\n  if (payload.identifier && !payload.username) {\n    payload.username = payload.identifier;\n  }\n  delete payload.identifier;\n  delete payload.remember;\n  return payload;\n}\nexport default {\n  login,\n  register,\n  logout,\n  refreshToken\n};","map":{"version":3,"names":["axios","http","API_BASE_URL","normalizeHttpError","AUTH_PREFIX","CSRF_STORAGE_KEY","login","credentials","payload","normalizeLoginPayload","data","post","skipAuthRefresh","normalizeAuthResponse","error","register","logout","localStorage","removeItem","refreshToken","response","headers","timeout","token","accessToken","access_token","refresh_token","expiresIn","expires_in","csrfToken","csrf_token","user","expiresAt","Number","Date","now","setItem","console","warn","raw","identifier","username","remember"],"sources":["C:/Users/Administrator/Desktop/zonshe/ecommerce-frontend/src/services/api/authAPI.js"],"sourcesContent":["import axios from 'axios';\nimport http, { API_BASE_URL, normalizeHttpError } from '../http';\n\nconst AUTH_PREFIX = '/api/v1/user';\nconst CSRF_STORAGE_KEY = 'auth.csrfToken';\n\nexport async function login(credentials) {\n  const payload = normalizeLoginPayload(credentials);\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/login`, payload, {\n      skipAuthRefresh: true\n    });\n    return normalizeAuthResponse(data);\n  } catch (error) {\n    throw normalizeHttpError(error, '登录失败，请检查账号信息。');\n  }\n}\n\nexport async function register(payload) {\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/register`, payload, {\n      skipAuthRefresh: true\n    });\n    return normalizeAuthResponse(data);\n  } catch (error) {\n    throw normalizeHttpError(error, '注册失败，请稍后再试。');\n  }\n}\n\nexport async function logout() {\n  try {\n    await http.post(`${AUTH_PREFIX}/logout`);\n  } catch (error) {\n    throw normalizeHttpError(error, '退出登录失败，请稍后再试。');\n  }\n  localStorage.removeItem(CSRF_STORAGE_KEY);\n}\n\nexport async function refreshToken(refreshToken) {\n  try {\n    const response = await axios.post(\n      `${API_BASE_URL}${AUTH_PREFIX}/token/refresh`,\n      { refreshToken },\n      {\n        headers: { 'Content-Type': 'application/json' },\n        timeout: 8000\n      }\n    );\n    return normalizeAuthResponse(response.data);\n  } catch (error) {\n    throw normalizeHttpError(error, '刷新登录状态失败，请重新登录。');\n  }\n}\n\nfunction normalizeAuthResponse(data = {}) {\n  const payload =\n    data && typeof data === 'object' && typeof data.data === 'object'\n      ? data.data\n      : data;\n\n  const token =\n    payload.token ||\n    payload.accessToken ||\n    payload.access_token ||\n    data.token ||\n    null;\n  const refreshToken =\n    payload.refreshToken ||\n    payload.refresh_token ||\n    data.refreshToken ||\n    null;\n  const expiresIn =\n    payload.expiresIn ||\n    payload.expires_in ||\n    data.expiresIn ||\n    null;\n  const csrfToken =\n    payload.csrfToken || payload.csrf_token || data.csrfToken || null;\n  const user = payload.user || data.user || null;\n\n  const expiresAt = payload.expiresAt\n    ? Number(payload.expiresAt)\n    : expiresIn\n      ? Date.now() + Number(expiresIn) * 1000\n      : null;\n\n  if (csrfToken) {\n    try {\n      localStorage.setItem(CSRF_STORAGE_KEY, csrfToken);\n    } catch (error) {\n      console.warn('[authAPI] 存储 CSRF 令牌失败:', error);\n    }\n  }\n  return {\n    token,\n    refreshToken,\n    expiresAt,\n    user,\n    raw: data\n  };\n}\n\nfunction normalizeLoginPayload(credentials = {}) {\n  const payload = { ...credentials };\n  if (payload.identifier && !payload.username) {\n    payload.username = payload.identifier;\n  }\n  delete payload.identifier;\n  delete payload.remember;\n  return payload;\n}\n\nexport default {\n  login,\n  register,\n  logout,\n  refreshToken\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}