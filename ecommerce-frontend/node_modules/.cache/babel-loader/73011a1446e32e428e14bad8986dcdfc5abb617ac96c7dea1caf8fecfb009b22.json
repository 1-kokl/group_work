{"ast":null,"code":"import { createVNode as _createVNode, resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, Transition as _Transition, withCtx as _withCtx, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"global-status\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_alert = _resolveComponent(\"el-alert\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode($setup[\"LoadingOverlay\"], {\n    visible: $setup.globalLoading,\n    message: $setup.loadingMessage\n  }, null, 8 /* PROPS */, [\"visible\", \"message\"]), _createVNode(_Transition, {\n    name: \"slide-fade\"\n  }, {\n    default: _withCtx(() => [$setup.visibleError ? (_openBlock(), _createBlock(_component_el_alert, {\n      key: 0,\n      class: \"global-error\",\n      type: \"error\",\n      closable: true,\n      \"show-icon\": \"\",\n      title: $setup.visibleError.message || '请求发生错误，请稍后再试。',\n      onClose: $setup.handleClose\n    }, null, 8 /* PROPS */, [\"title\"])) : _createCommentVNode(\"v-if\", true)]),\n    _: 1 /* STABLE */\n  })]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createVNode","$setup","visible","globalLoading","message","loadingMessage","_Transition","name","visibleError","_createBlock","_component_el_alert","type","closable","title","onClose","handleClose"],"sources":["C:\\Users\\Administrator\\Desktop\\zonshe\\ecommerce-frontend\\src\\components\\common\\GlobalStatus.vue"],"sourcesContent":["<template>\r\n  <div class=\"global-status\">\r\n    <LoadingOverlay :visible=\"globalLoading\" :message=\"loadingMessage\" />\r\n\r\n    <transition name=\"slide-fade\">\r\n      <el-alert\r\n        v-if=\"visibleError\"\r\n        class=\"global-error\"\r\n        type=\"error\"\r\n        :closable=\"true\"\r\n        show-icon\r\n        :title=\"visibleError.message || '请求发生错误，请稍后再试。'\"\r\n        @close=\"handleClose\"\r\n      />\r\n    </transition>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { computed, ref, watch, onBeforeUnmount } from 'vue';\r\nimport { useStore } from 'vuex';\r\nimport LoadingOverlay from './LoadingOverlay.vue';\r\n\r\nconst store = useStore();\r\n\r\nconst globalLoading = computed(() => store.getters.globalLoading);\r\nconst globalError = computed(() => store.getters.globalError);\r\nconst loadingMessage = computed(() =>\r\n  globalLoading.value ? '正在同步最新数据，请稍候…' : ''\r\n);\r\n\r\nconst visibleError = ref(null);\r\nlet hideTimer = null;\r\n\r\nfunction startAutoHide() {\r\n  if (hideTimer) clearTimeout(hideTimer);\r\n  hideTimer = setTimeout(() => {\r\n    handleClose();\r\n  }, 5000);\r\n}\r\n\r\nfunction handleClose() {\r\n  visibleError.value = null;\r\n  store.commit('SET_GLOBAL_ERROR', null);\r\n}\r\n\r\nwatch(\r\n  globalError,\r\n  (error) => {\r\n    if (!error) {\r\n      handleClose();\r\n      return;\r\n    }\r\n    visibleError.value = {\r\n      message: error.message,\r\n      code: error.code,\r\n      status: error.status\r\n    };\r\n    startAutoHide();\r\n  },\r\n  { immediate: true }\r\n);\r\n\r\nonBeforeUnmount(() => {\r\n  if (hideTimer) clearTimeout(hideTimer);\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.global-error {\r\n  position: fixed;\r\n  top: 88px;\r\n  right: 16px;\r\n  width: min(360px, calc(100vw - 32px));\r\n  z-index: 1300;\r\n}\r\n\r\n.slide-fade-enter-active,\r\n.slide-fade-leave-active {\r\n  transition: all 0.25s ease;\r\n}\r\n\r\n.slide-fade-enter-from,\r\n.slide-fade-leave-to {\r\n  opacity: 0;\r\n  transform: translateY(-12px);\r\n}\r\n</style>\r\n\r\n"],"mappings":";;EACOA,KAAK,EAAC;AAAe;;;uBAA1BC,mBAAA,CAcM,OAdNC,UAcM,GAbJC,YAAA,CAAqEC,MAAA;IAApDC,OAAO,EAAED,MAAA,CAAAE,aAAa;IAAGC,OAAO,EAAEH,MAAA,CAAAI;mDAEnDL,YAAA,CAUaM,WAAA;IAVDC,IAAI,EAAC;EAAY;sBAG9B,MAMH,CAPcN,MAAA,CAAAO,YAAY,I,cADpBC,YAAA,CAQEC,mBAAA;;MANAb,KAAK,EAAC,cAAc;MACpBc,IAAI,EAAC,OAAO;MACXC,QAAQ,EAAE,IAAI;MACf,WAAS,EAAT,EAAS;MACRC,KAAK,EAAEZ,MAAA,CAAAO,YAAY,CAACJ,OAAO;MAC3BU,OAAK,EAAEb,MAAA,CAAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}