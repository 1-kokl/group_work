{"ast":null,"code":"import http, { normalizeHttpError } from '../http';\nimport { getCache, setCache, clearCache } from '../../utils/cache';\nconst USER_PREFIX = '/api/v1/user';\nconst PROFILE_PREFIX = '/api/v1/users/me';\nconst PROFILE_CACHE_KEY = 'user:profile';\nconst DEVICE_CACHE_KEY = 'user:devices';\nexport async function getProfile(options = {}) {\n  const {\n    force = false,\n    cacheTtl = 5 * 60 * 1000\n  } = options || {};\n  if (!force) {\n    const cachedProfile = getCache(PROFILE_CACHE_KEY);\n    if (cachedProfile) {\n      return cachedProfile;\n    }\n  }\n  try {\n    const profile = await http.get(`${USER_PREFIX}/info`);\n    setCache(PROFILE_CACHE_KEY, profile, cacheTtl);\n    return profile;\n  } catch (error) {\n    throw normalizeHttpError(error, '获取用户信息失败，请稍后重试。');\n  }\n}\nexport async function updateProfile(payload = {}) {\n  try {\n    const {\n      phone,\n      ...rest\n    } = payload;\n    let result = null;\n    if (Object.keys(rest).length) {\n      result = await http.patch(`${PROFILE_PREFIX}`, rest);\n    }\n    if (phone !== undefined) {\n      result = await http.patch(`${PROFILE_PREFIX}/phone`, {\n        phone\n      });\n    }\n    clearCache(PROFILE_CACHE_KEY);\n    return result;\n  } catch (error) {\n    throw normalizeHttpError(error, '更新个人信息失败，请稍后再试。');\n  }\n}\nexport async function changePassword(payload) {\n  try {\n    return await http.post(`${USER_PREFIX}/change-password`, payload);\n  } catch (error) {\n    throw normalizeHttpError(error, '修改密码失败，请检查后再试。');\n  }\n}\nexport async function getDevices() {\n  try {\n    const cachedDevices = getCache(DEVICE_CACHE_KEY);\n    if (cachedDevices) {\n      return cachedDevices;\n    }\n    const result = await http.get(`${USER_PREFIX}/devices`);\n    const devices = Array.isArray(result) ? result : [];\n    setCache(DEVICE_CACHE_KEY, devices, 5 * 60 * 1000);\n    return devices;\n  } catch (error) {\n    throw normalizeHttpError(error, '获取登录设备失败，请稍后再试。');\n  }\n}\nexport function invalidateUserCaches() {\n  clearCache(PROFILE_CACHE_KEY);\n  clearCache(DEVICE_CACHE_KEY);\n}\nexport default {\n  getProfile,\n  updateProfile,\n  changePassword,\n  getDevices,\n  invalidateUserCaches\n};","map":{"version":3,"names":["http","normalizeHttpError","getCache","setCache","clearCache","USER_PREFIX","PROFILE_PREFIX","PROFILE_CACHE_KEY","DEVICE_CACHE_KEY","getProfile","options","force","cacheTtl","cachedProfile","profile","get","error","updateProfile","payload","phone","rest","result","Object","keys","length","patch","undefined","changePassword","post","getDevices","cachedDevices","devices","Array","isArray","invalidateUserCaches"],"sources":["C:/Users/Administrator/Desktop/zonshe/ecommerce-frontend/src/services/api/userAPI.js"],"sourcesContent":["import http, { normalizeHttpError } from '../http';\nimport { getCache, setCache, clearCache } from '../../utils/cache';\n\nconst USER_PREFIX = '/api/v1/user';\nconst PROFILE_PREFIX = '/api/v1/users/me';\nconst PROFILE_CACHE_KEY = 'user:profile';\nconst DEVICE_CACHE_KEY = 'user:devices';\n\nexport async function getProfile(options = {}) {\n  const { force = false, cacheTtl = 5 * 60 * 1000 } = options || {};\n  if (!force) {\n    const cachedProfile = getCache(PROFILE_CACHE_KEY);\n    if (cachedProfile) {\n      return cachedProfile;\n    }\n  }\n\n  try {\n    const profile = await http.get(`${USER_PREFIX}/info`);\n    setCache(PROFILE_CACHE_KEY, profile, cacheTtl);\n    return profile;\n  } catch (error) {\n    throw normalizeHttpError(error, '获取用户信息失败，请稍后重试。');\n  }\n}\n\nexport async function updateProfile(payload = {}) {\n  try {\n    const { phone, ...rest } = payload;\n    let result = null;\n\n    if (Object.keys(rest).length) {\n      result = await http.patch(`${PROFILE_PREFIX}`, rest);\n    }\n\n    if (phone !== undefined) {\n      result = await http.patch(`${PROFILE_PREFIX}/phone`, { phone });\n    }\n\n    clearCache(PROFILE_CACHE_KEY);\n    return result;\n  } catch (error) {\n    throw normalizeHttpError(error, '更新个人信息失败，请稍后再试。');\n  }\n}\n\nexport async function changePassword(payload) {\n  try {\n    return await http.post(`${USER_PREFIX}/change-password`, payload);\n  } catch (error) {\n    throw normalizeHttpError(error, '修改密码失败，请检查后再试。');\n  }\n}\n\nexport async function getDevices() {\n  try {\n    const cachedDevices = getCache(DEVICE_CACHE_KEY);\n    if (cachedDevices) {\n      return cachedDevices;\n    }\n\n    const result = await http.get(`${USER_PREFIX}/devices`);\n    const devices = Array.isArray(result) ? result : [];\n    setCache(DEVICE_CACHE_KEY, devices, 5 * 60 * 1000);\n    return devices;\n  } catch (error) {\n    throw normalizeHttpError(error, '获取登录设备失败，请稍后再试。');\n  }\n}\n\nexport function invalidateUserCaches() {\n  clearCache(PROFILE_CACHE_KEY);\n  clearCache(DEVICE_CACHE_KEY);\n}\n\nexport default {\n  getProfile,\n  updateProfile,\n  changePassword,\n  getDevices,\n  invalidateUserCaches\n};\n\n"],"mappings":"AAAA,OAAOA,IAAI,IAAIC,kBAAkB,QAAQ,SAAS;AAClD,SAASC,QAAQ,EAAEC,QAAQ,EAAEC,UAAU,QAAQ,mBAAmB;AAElE,MAAMC,WAAW,GAAG,cAAc;AAClC,MAAMC,cAAc,GAAG,kBAAkB;AACzC,MAAMC,iBAAiB,GAAG,cAAc;AACxC,MAAMC,gBAAgB,GAAG,cAAc;AAEvC,OAAO,eAAeC,UAAUA,CAACC,OAAO,GAAG,CAAC,CAAC,EAAE;EAC7C,MAAM;IAAEC,KAAK,GAAG,KAAK;IAAEC,QAAQ,GAAG,CAAC,GAAG,EAAE,GAAG;EAAK,CAAC,GAAGF,OAAO,IAAI,CAAC,CAAC;EACjE,IAAI,CAACC,KAAK,EAAE;IACV,MAAME,aAAa,GAAGX,QAAQ,CAACK,iBAAiB,CAAC;IACjD,IAAIM,aAAa,EAAE;MACjB,OAAOA,aAAa;IACtB;EACF;EAEA,IAAI;IACF,MAAMC,OAAO,GAAG,MAAMd,IAAI,CAACe,GAAG,CAAC,GAAGV,WAAW,OAAO,CAAC;IACrDF,QAAQ,CAACI,iBAAiB,EAAEO,OAAO,EAAEF,QAAQ,CAAC;IAC9C,OAAOE,OAAO;EAChB,CAAC,CAAC,OAAOE,KAAK,EAAE;IACd,MAAMf,kBAAkB,CAACe,KAAK,EAAE,iBAAiB,CAAC;EACpD;AACF;AAEA,OAAO,eAAeC,aAAaA,CAACC,OAAO,GAAG,CAAC,CAAC,EAAE;EAChD,IAAI;IACF,MAAM;MAAEC,KAAK;MAAE,GAAGC;IAAK,CAAC,GAAGF,OAAO;IAClC,IAAIG,MAAM,GAAG,IAAI;IAEjB,IAAIC,MAAM,CAACC,IAAI,CAACH,IAAI,CAAC,CAACI,MAAM,EAAE;MAC5BH,MAAM,GAAG,MAAMrB,IAAI,CAACyB,KAAK,CAAC,GAAGnB,cAAc,EAAE,EAAEc,IAAI,CAAC;IACtD;IAEA,IAAID,KAAK,KAAKO,SAAS,EAAE;MACvBL,MAAM,GAAG,MAAMrB,IAAI,CAACyB,KAAK,CAAC,GAAGnB,cAAc,QAAQ,EAAE;QAAEa;MAAM,CAAC,CAAC;IACjE;IAEAf,UAAU,CAACG,iBAAiB,CAAC;IAC7B,OAAOc,MAAM;EACf,CAAC,CAAC,OAAOL,KAAK,EAAE;IACd,MAAMf,kBAAkB,CAACe,KAAK,EAAE,iBAAiB,CAAC;EACpD;AACF;AAEA,OAAO,eAAeW,cAAcA,CAACT,OAAO,EAAE;EAC5C,IAAI;IACF,OAAO,MAAMlB,IAAI,CAAC4B,IAAI,CAAC,GAAGvB,WAAW,kBAAkB,EAAEa,OAAO,CAAC;EACnE,CAAC,CAAC,OAAOF,KAAK,EAAE;IACd,MAAMf,kBAAkB,CAACe,KAAK,EAAE,gBAAgB,CAAC;EACnD;AACF;AAEA,OAAO,eAAea,UAAUA,CAAA,EAAG;EACjC,IAAI;IACF,MAAMC,aAAa,GAAG5B,QAAQ,CAACM,gBAAgB,CAAC;IAChD,IAAIsB,aAAa,EAAE;MACjB,OAAOA,aAAa;IACtB;IAEA,MAAMT,MAAM,GAAG,MAAMrB,IAAI,CAACe,GAAG,CAAC,GAAGV,WAAW,UAAU,CAAC;IACvD,MAAM0B,OAAO,GAAGC,KAAK,CAACC,OAAO,CAACZ,MAAM,CAAC,GAAGA,MAAM,GAAG,EAAE;IACnDlB,QAAQ,CAACK,gBAAgB,EAAEuB,OAAO,EAAE,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC;IAClD,OAAOA,OAAO;EAChB,CAAC,CAAC,OAAOf,KAAK,EAAE;IACd,MAAMf,kBAAkB,CAACe,KAAK,EAAE,iBAAiB,CAAC;EACpD;AACF;AAEA,OAAO,SAASkB,oBAAoBA,CAAA,EAAG;EACrC9B,UAAU,CAACG,iBAAiB,CAAC;EAC7BH,UAAU,CAACI,gBAAgB,CAAC;AAC9B;AAEA,eAAe;EACbC,UAAU;EACVQ,aAAa;EACbU,cAAc;EACdE,UAAU;EACVK;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}