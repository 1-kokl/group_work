{"ast":null,"code":"import { computed, ref, watch, onBeforeUnmount } from 'vue';\nimport { useStore } from 'vuex';\nimport LoadingOverlay from './LoadingOverlay.vue';\nexport default {\n  __name: 'GlobalStatus',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const store = useStore();\n    const globalLoading = computed(() => store.getters.globalLoading);\n    const globalError = computed(() => store.getters.globalError);\n    const loadingMessage = computed(() => globalLoading.value ? '正在同步最新数据，请稍候…' : '');\n    const visibleError = ref(null);\n    let hideTimer = null;\n    function startAutoHide() {\n      if (hideTimer) clearTimeout(hideTimer);\n      hideTimer = setTimeout(() => {\n        handleClose();\n      }, 5000);\n    }\n    function handleClose() {\n      visibleError.value = null;\n      store.commit('SET_GLOBAL_ERROR', null);\n    }\n    watch(globalError, error => {\n      if (!error) {\n        handleClose();\n        return;\n      }\n      visibleError.value = {\n        message: error.message,\n        code: error.code,\n        status: error.status\n      };\n      startAutoHide();\n    }, {\n      immediate: true\n    });\n    onBeforeUnmount(() => {\n      if (hideTimer) clearTimeout(hideTimer);\n    });\n    const __returned__ = {\n      store,\n      globalLoading,\n      globalError,\n      loadingMessage,\n      visibleError,\n      get hideTimer() {\n        return hideTimer;\n      },\n      set hideTimer(v) {\n        hideTimer = v;\n      },\n      startAutoHide,\n      handleClose,\n      computed,\n      ref,\n      watch,\n      onBeforeUnmount,\n      get useStore() {\n        return useStore;\n      },\n      LoadingOverlay\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["computed","ref","watch","onBeforeUnmount","useStore","LoadingOverlay","store","globalLoading","getters","globalError","loadingMessage","value","visibleError","hideTimer","startAutoHide","clearTimeout","setTimeout","handleClose","commit","error","message","code","status","immediate"],"sources":["C:/Users/Administrator/Desktop/zonshe/ecommerce-frontend/src/components/common/GlobalStatus.vue"],"sourcesContent":["<template>\r\n  <div class=\"global-status\">\r\n    <LoadingOverlay :visible=\"globalLoading\" :message=\"loadingMessage\" />\r\n\r\n    <transition name=\"slide-fade\">\r\n      <el-alert\r\n        v-if=\"visibleError\"\r\n        class=\"global-error\"\r\n        type=\"error\"\r\n        :closable=\"true\"\r\n        show-icon\r\n        :title=\"visibleError.message || '请求发生错误，请稍后再试。'\"\r\n        @close=\"handleClose\"\r\n      />\r\n    </transition>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { computed, ref, watch, onBeforeUnmount } from 'vue';\r\nimport { useStore } from 'vuex';\r\nimport LoadingOverlay from './LoadingOverlay.vue';\r\n\r\nconst store = useStore();\r\n\r\nconst globalLoading = computed(() => store.getters.globalLoading);\r\nconst globalError = computed(() => store.getters.globalError);\r\nconst loadingMessage = computed(() =>\r\n  globalLoading.value ? '正在同步最新数据，请稍候…' : ''\r\n);\r\n\r\nconst visibleError = ref(null);\r\nlet hideTimer = null;\r\n\r\nfunction startAutoHide() {\r\n  if (hideTimer) clearTimeout(hideTimer);\r\n  hideTimer = setTimeout(() => {\r\n    handleClose();\r\n  }, 5000);\r\n}\r\n\r\nfunction handleClose() {\r\n  visibleError.value = null;\r\n  store.commit('SET_GLOBAL_ERROR', null);\r\n}\r\n\r\nwatch(\r\n  globalError,\r\n  (error) => {\r\n    if (!error) {\r\n      handleClose();\r\n      return;\r\n    }\r\n    visibleError.value = {\r\n      message: error.message,\r\n      code: error.code,\r\n      status: error.status\r\n    };\r\n    startAutoHide();\r\n  },\r\n  { immediate: true }\r\n);\r\n\r\nonBeforeUnmount(() => {\r\n  if (hideTimer) clearTimeout(hideTimer);\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.global-error {\r\n  position: fixed;\r\n  top: 88px;\r\n  right: 16px;\r\n  width: min(360px, calc(100vw - 32px));\r\n  z-index: 1300;\r\n}\r\n\r\n.slide-fade-enter-active,\r\n.slide-fade-leave-active {\r\n  transition: all 0.25s ease;\r\n}\r\n\r\n.slide-fade-enter-from,\r\n.slide-fade-leave-to {\r\n  opacity: 0;\r\n  transform: translateY(-12px);\r\n}\r\n</style>\r\n\r\n"],"mappings":"AAmBA,SAASA,QAAQ,EAAEC,GAAG,EAAEC,KAAK,EAAEC,eAAe,QAAQ,KAAK;AAC3D,SAASC,QAAQ,QAAQ,MAAM;AAC/B,OAAOC,cAAc,MAAM,sBAAsB;;;;;;;IAEjD,MAAMC,KAAK,GAAGF,QAAQ,CAAC,CAAC;IAExB,MAAMG,aAAa,GAAGP,QAAQ,CAAC,MAAMM,KAAK,CAACE,OAAO,CAACD,aAAa,CAAC;IACjE,MAAME,WAAW,GAAGT,QAAQ,CAAC,MAAMM,KAAK,CAACE,OAAO,CAACC,WAAW,CAAC;IAC7D,MAAMC,cAAc,GAAGV,QAAQ,CAAC,MAC9BO,aAAa,CAACI,KAAK,GAAG,eAAe,GAAG,EAC1C,CAAC;IAED,MAAMC,YAAY,GAAGX,GAAG,CAAC,IAAI,CAAC;IAC9B,IAAIY,SAAS,GAAG,IAAI;IAEpB,SAASC,aAAaA,CAAA,EAAG;MACvB,IAAID,SAAS,EAAEE,YAAY,CAACF,SAAS,CAAC;MACtCA,SAAS,GAAGG,UAAU,CAAC,MAAM;QAC3BC,WAAW,CAAC,CAAC;MACf,CAAC,EAAE,IAAI,CAAC;IACV;IAEA,SAASA,WAAWA,CAAA,EAAG;MACrBL,YAAY,CAACD,KAAK,GAAG,IAAI;MACzBL,KAAK,CAACY,MAAM,CAAC,kBAAkB,EAAE,IAAI,CAAC;IACxC;IAEAhB,KAAK,CACHO,WAAW,EACVU,KAAK,IAAK;MACT,IAAI,CAACA,KAAK,EAAE;QACVF,WAAW,CAAC,CAAC;QACb;MACF;MACAL,YAAY,CAACD,KAAK,GAAG;QACnBS,OAAO,EAAED,KAAK,CAACC,OAAO;QACtBC,IAAI,EAAEF,KAAK,CAACE,IAAI;QAChBC,MAAM,EAAEH,KAAK,CAACG;MAChB,CAAC;MACDR,aAAa,CAAC,CAAC;IACjB,CAAC,EACD;MAAES,SAAS,EAAE;IAAK,CACpB,CAAC;IAEDpB,eAAe,CAAC,MAAM;MACpB,IAAIU,SAAS,EAAEE,YAAY,CAACF,SAAS,CAAC;IACxC,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}