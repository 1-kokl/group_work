{"ast":null,"code":"import { createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createElementVNode as _createElementVNode, createBlock as _createBlock, renderList as _renderList, Fragment as _Fragment } from \"vue\";\nconst _hoisted_1 = {\n  class: \"profile-wrapper\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"profile-skeleton-stack\"\n};\nconst _hoisted_3 = {\n  class: \"profile-summary\"\n};\nconst _hoisted_4 = {\n  class: \"summary-info\"\n};\nconst _hoisted_5 = {\n  class: \"summary-email\"\n};\nconst _hoisted_6 = {\n  class: \"summary-list\"\n};\nconst _hoisted_7 = {\n  class: \"card-header\"\n};\nconst _hoisted_8 = {\n  class: \"device-item\"\n};\nconst _hoisted_9 = {\n  class: \"card-header\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_avatar = _resolveComponent(\"el-avatar\");\n  const _component_el_tag = _resolveComponent(\"el-tag\");\n  const _component_el_divider = _resolveComponent(\"el-divider\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_skeleton = _resolveComponent(\"el-skeleton\");\n  const _component_el_empty = _resolveComponent(\"el-empty\");\n  const _component_el_timeline_item = _resolveComponent(\"el-timeline-item\");\n  const _component_el_timeline = _resolveComponent(\"el-timeline\");\n  const _component_el_col = _resolveComponent(\"el-col\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  const _component_el_row = _resolveComponent(\"el-row\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$setup.isBusy ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createVNode($setup[\"SkeletonCard\"]), _createVNode($setup[\"SkeletonCard\"])])) : (_openBlock(), _createBlock(_component_el_row, {\n    key: 1,\n    gutter: 20\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_col, {\n      xs: 24,\n      md: 8\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_card, {\n        class: \"profile-card\",\n        shadow: \"hover\"\n      }, {\n        default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_avatar, {\n          src: $setup.userAvatar,\n          size: \"large\"\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.initials), 1 /* TEXT */)]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"src\"]), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"h2\", null, _toDisplayString($setup.userDisplayName), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_5, _toDisplayString($setup.profile.email || '未绑定邮箱'), 1 /* TEXT */), $setup.primaryRole ? (_openBlock(), _createBlock(_component_el_tag, {\n          key: 0,\n          size: \"small\",\n          type: \"success\"\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.primaryRole), 1 /* TEXT */)]),\n          _: 1 /* STABLE */\n        })) : _createCommentVNode(\"v-if\", true)])]), _createVNode(_component_el_divider), _createElementVNode(\"ul\", _hoisted_6, [_createElementVNode(\"li\", null, [_cache[7] || (_cache[7] = _createElementVNode(\"span\", null, \"注册时间\", -1 /* CACHED */)), _createElementVNode(\"span\", null, _toDisplayString($setup.formattedRegisterTime), 1 /* TEXT */)]), _createElementVNode(\"li\", null, [_cache[8] || (_cache[8] = _createElementVNode(\"span\", null, \"绑定手机号\", -1 /* CACHED */)), _createElementVNode(\"span\", null, _toDisplayString($setup.maskedPhone), 1 /* TEXT */)]), _createElementVNode(\"li\", null, [_cache[9] || (_cache[9] = _createElementVNode(\"span\", null, \"最近登录\", -1 /* CACHED */)), _createElementVNode(\"span\", null, _toDisplayString($setup.latestDeviceTime), 1 /* TEXT */)])])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_card, {\n        class: \"devices-card\",\n        shadow: \"hover\"\n      }, {\n        header: _withCtx(() => [_createElementVNode(\"div\", _hoisted_7, [_cache[11] || (_cache[11] = _createElementVNode(\"span\", null, \"登录设备\", -1 /* CACHED */)), _createVNode(_component_el_button, {\n          type: \"text\",\n          icon: $setup.RefreshRight,\n          onClick: $setup.loadDevices,\n          loading: $setup.deviceLoading\n        }, {\n          default: _withCtx(() => [...(_cache[10] || (_cache[10] = [_createTextVNode(\" 刷新 \", -1 /* CACHED */)]))]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"icon\", \"loading\"])])]),\n        default: _withCtx(() => [$setup.deviceLoading ? (_openBlock(), _createBlock(_component_el_skeleton, {\n          key: 0,\n          animated: \"\"\n        })) : !$setup.devices.length ? (_openBlock(), _createBlock(_component_el_empty, {\n          key: 1,\n          description: \"暂无登录设备信息\"\n        })) : (_openBlock(), _createBlock(_component_el_timeline, {\n          key: 2\n        }, {\n          default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.devices, device => {\n            return _openBlock(), _createBlock(_component_el_timeline_item, {\n              key: device.id,\n              timestamp: $setup.formatDate(device.lastActiveAt),\n              placement: \"top\"\n            }, {\n              default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"div\", null, [_createElementVNode(\"strong\", null, _toDisplayString(device.platform || '未知设备'), 1 /* TEXT */), _createElementVNode(\"p\", null, _toDisplayString(device.browser || '未知浏览器'), 1 /* TEXT */)]), _createElementVNode(\"small\", null, \"IP：\" + _toDisplayString(device.ip || '未知'), 1 /* TEXT */)])]),\n              _: 2 /* DYNAMIC */\n            }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"timestamp\"]);\n          }), 128 /* KEYED_FRAGMENT */))]),\n          _: 1 /* STABLE */\n        }))]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_col, {\n      xs: 24,\n      md: 16\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_card, {\n        class: \"profile-card\",\n        shadow: \"hover\"\n      }, {\n        header: _withCtx(() => [_createElementVNode(\"div\", _hoisted_9, [_cache[12] || (_cache[12] = _createElementVNode(\"span\", null, \"个人信息\", -1 /* CACHED */)), _createVNode(_component_el_button, {\n          type: \"primary\",\n          size: \"small\",\n          plain: \"\",\n          onClick: $setup.toggleEdit\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.editing ? '取消' : '编辑资料'), 1 /* TEXT */)]),\n          _: 1 /* STABLE */\n        })])]),\n        default: _withCtx(() => [_createVNode(_component_el_form, {\n          ref: \"infoFormRef\",\n          model: $setup.infoForm,\n          rules: $setup.infoRules,\n          \"label-width\": \"110px\",\n          class: \"info-form\",\n          disabled: !$setup.editing\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_form_item, {\n            label: \"用户名\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_input, {\n              modelValue: $setup.infoForm.username,\n              \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.infoForm.username = $event),\n              disabled: \"\"\n            }, null, 8 /* PROPS */, [\"modelValue\"])]),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_form_item, {\n            label: \"邮箱\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_input, {\n              modelValue: $setup.infoForm.email,\n              \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.infoForm.email = $event),\n              disabled: \"\"\n            }, null, 8 /* PROPS */, [\"modelValue\"])]),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_form_item, {\n            prop: \"phone\",\n            label: \"手机号\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_input, {\n              modelValue: $setup.infoForm.phone,\n              \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.infoForm.phone = $event),\n              maxlength: \"11\",\n              placeholder: \"请输入新的手机号\"\n            }, null, 8 /* PROPS */, [\"modelValue\"])]),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_form_item, {\n            prop: \"bio\",\n            label: \"个人简介\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_input, {\n              modelValue: $setup.infoForm.bio,\n              \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $setup.infoForm.bio = $event),\n              type: \"textarea\",\n              rows: \"3\",\n              maxlength: \"200\",\n              \"show-word-limit\": \"\",\n              placeholder: \"简单介绍一下自己\"\n            }, null, 8 /* PROPS */, [\"modelValue\"])]),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_form_item, null, {\n            default: _withCtx(() => [_createVNode(_component_el_button, {\n              type: \"primary\",\n              loading: $setup.infoLoading,\n              onClick: $setup.submitInfo\n            }, {\n              default: _withCtx(() => [...(_cache[13] || (_cache[13] = [_createTextVNode(\" 保存 \", -1 /* CACHED */)]))]),\n              _: 1 /* STABLE */\n            }, 8 /* PROPS */, [\"loading\"]), _createVNode(_component_el_button, {\n              onClick: $setup.resetInfo\n            }, {\n              default: _withCtx(() => [...(_cache[14] || (_cache[14] = [_createTextVNode(\"重置\", -1 /* CACHED */)]))]),\n              _: 1 /* STABLE */\n            })]),\n            _: 1 /* STABLE */\n          })]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"model\", \"disabled\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_card, {\n        class: \"profile-card\",\n        shadow: \"hover\"\n      }, {\n        header: _withCtx(() => [...(_cache[15] || (_cache[15] = [_createElementVNode(\"span\", null, \"密码修改\", -1 /* CACHED */)]))]),\n        default: _withCtx(() => [_createVNode(_component_el_form, {\n          ref: \"passwordFormRef\",\n          model: $setup.passwordForm,\n          rules: $setup.passwordRules,\n          \"label-width\": \"110px\",\n          class: \"password-form\"\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_form_item, {\n            prop: \"oldPassword\",\n            label: \"当前密码\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_input, {\n              modelValue: $setup.passwordForm.oldPassword,\n              \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $setup.passwordForm.oldPassword = $event),\n              type: \"password\",\n              autocomplete: \"current-password\",\n              placeholder: \"请输入当前密码\"\n            }, null, 8 /* PROPS */, [\"modelValue\"])]),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_form_item, {\n            prop: \"newPassword\",\n            label: \"新密码\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_input, {\n              modelValue: $setup.passwordForm.newPassword,\n              \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $setup.passwordForm.newPassword = $event),\n              type: \"password\",\n              autocomplete: \"new-password\",\n              placeholder: \"请输入新密码\"\n            }, null, 8 /* PROPS */, [\"modelValue\"])]),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_form_item, {\n            prop: \"confirmPassword\",\n            label: \"确认新密码\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_input, {\n              modelValue: $setup.passwordForm.confirmPassword,\n              \"onUpdate:modelValue\": _cache[6] || (_cache[6] = $event => $setup.passwordForm.confirmPassword = $event),\n              type: \"password\",\n              autocomplete: \"new-password\",\n              placeholder: \"请再次输入新密码\"\n            }, null, 8 /* PROPS */, [\"modelValue\"])]),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_form_item, null, {\n            default: _withCtx(() => [_createVNode(_component_el_button, {\n              type: \"primary\",\n              loading: $setup.passwordLoading,\n              onClick: $setup.submitPassword\n            }, {\n              default: _withCtx(() => [...(_cache[16] || (_cache[16] = [_createTextVNode(\" 修改密码 \", -1 /* CACHED */)]))]),\n              _: 1 /* STABLE */\n            }, 8 /* PROPS */, [\"loading\"]), _createVNode(_component_el_button, {\n              onClick: $setup.resetPasswordForm\n            }, {\n              default: _withCtx(() => [...(_cache[17] || (_cache[17] = [_createTextVNode(\"重置\", -1 /* CACHED */)]))]),\n              _: 1 /* STABLE */\n            })]),\n            _: 1 /* STABLE */\n          })]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"model\"])]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  }))]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","$setup","isBusy","_hoisted_2","_createVNode","_createBlock","_component_el_row","gutter","_component_el_col","xs","md","_component_el_card","shadow","_createElementVNode","_hoisted_3","_component_el_avatar","src","userAvatar","size","initials","_hoisted_4","_toDisplayString","userDisplayName","_hoisted_5","profile","email","primaryRole","_component_el_tag","type","_component_el_divider","_hoisted_6","formattedRegisterTime","maskedPhone","latestDeviceTime","header","_withCtx","_hoisted_7","_component_el_button","icon","RefreshRight","onClick","loadDevices","loading","deviceLoading","_cache","_component_el_skeleton","animated","devices","length","_component_el_empty","description","_component_el_timeline","key","_Fragment","_renderList","device","_component_el_timeline_item","id","timestamp","formatDate","lastActiveAt","placement","_hoisted_8","platform","browser","ip","_hoisted_9","plain","toggleEdit","editing","_component_el_form","ref","model","infoForm","rules","infoRules","disabled","_component_el_form_item","label","_component_el_input","username","$event","prop","phone","maxlength","placeholder","bio","rows","infoLoading","submitInfo","resetInfo","passwordForm","passwordRules","oldPassword","autocomplete","newPassword","confirmPassword","passwordLoading","submitPassword","resetPasswordForm"],"sources":["C:\\Users\\Administrator\\Desktop\\zonshe\\ecommerce-frontend\\src\\pages\\user\\Profile.vue"],"sourcesContent":["<template>\n  <div class=\"profile-wrapper\">\n    <div v-if=\"isBusy\" class=\"profile-skeleton-stack\">\n      <SkeletonCard />\n      <SkeletonCard />\n    </div>\n\n    <el-row v-else :gutter=\"20\">\n      <el-col :xs=\"24\" :md=\"8\">\n        <el-card class=\"profile-card\" shadow=\"hover\">\n          <div class=\"profile-summary\">\n            <el-avatar :src=\"userAvatar\" size=\"large\">\n              {{ initials }}\n            </el-avatar>\n            <div class=\"summary-info\">\n              <h2>{{ userDisplayName }}</h2>\n              <p class=\"summary-email\">{{ profile.email || '未绑定邮箱' }}</p>\n              <el-tag v-if=\"primaryRole\" size=\"small\" type=\"success\">\n                {{ primaryRole }}\n              </el-tag>\n            </div>\n          </div>\n          <el-divider />\n          <ul class=\"summary-list\">\n            <li>\n              <span>注册时间</span>\n              <span>{{ formattedRegisterTime }}</span>\n            </li>\n            <li>\n              <span>绑定手机号</span>\n              <span>{{ maskedPhone }}</span>\n            </li>\n            <li>\n              <span>最近登录</span>\n              <span>{{ latestDeviceTime }}</span>\n            </li>\n          </ul>\n        </el-card>\n\n        <el-card class=\"devices-card\" shadow=\"hover\">\n          <template #header>\n            <div class=\"card-header\">\n              <span>登录设备</span>\n              <el-button\n                type=\"text\"\n                :icon=\"RefreshRight\"\n                @click=\"loadDevices\"\n                :loading=\"deviceLoading\"\n              >\n                刷新\n              </el-button>\n            </div>\n          </template>\n\n          <el-skeleton v-if=\"deviceLoading\" animated />\n          <el-empty v-else-if=\"!devices.length\" description=\"暂无登录设备信息\" />\n          <el-timeline v-else>\n            <el-timeline-item\n              v-for=\"device in devices\"\n              :key=\"device.id\"\n              :timestamp=\"formatDate(device.lastActiveAt)\"\n              placement=\"top\"\n            >\n              <div class=\"device-item\">\n                <div>\n                  <strong>{{ device.platform || '未知设备' }}</strong>\n                  <p>{{ device.browser || '未知浏览器' }}</p>\n                </div>\n                <small>IP：{{ device.ip || '未知' }}</small>\n              </div>\n            </el-timeline-item>\n          </el-timeline>\n        </el-card>\n      </el-col>\n\n      <el-col :xs=\"24\" :md=\"16\">\n        <el-card class=\"profile-card\" shadow=\"hover\">\n          <template #header>\n            <div class=\"card-header\">\n              <span>个人信息</span>\n              <el-button\n                type=\"primary\"\n                size=\"small\"\n                plain\n                @click=\"toggleEdit\"\n              >\n                {{ editing ? '取消' : '编辑资料' }}\n              </el-button>\n            </div>\n          </template>\n\n          <el-form\n            ref=\"infoFormRef\"\n            :model=\"infoForm\"\n            :rules=\"infoRules\"\n            label-width=\"110px\"\n            class=\"info-form\"\n            :disabled=\"!editing\"\n          >\n            <el-form-item label=\"用户名\">\n              <el-input v-model=\"infoForm.username\" disabled />\n            </el-form-item>\n            <el-form-item label=\"邮箱\">\n              <el-input v-model=\"infoForm.email\" disabled />\n            </el-form-item>\n            <el-form-item prop=\"phone\" label=\"手机号\">\n              <el-input\n                v-model=\"infoForm.phone\"\n                maxlength=\"11\"\n                placeholder=\"请输入新的手机号\"\n              />\n            </el-form-item>\n            <el-form-item prop=\"bio\" label=\"个人简介\">\n              <el-input\n                v-model=\"infoForm.bio\"\n                type=\"textarea\"\n                rows=\"3\"\n                maxlength=\"200\"\n                show-word-limit\n                placeholder=\"简单介绍一下自己\"\n              />\n            </el-form-item>\n            <el-form-item>\n              <el-button\n                type=\"primary\"\n                :loading=\"infoLoading\"\n                @click=\"submitInfo\"\n              >\n                保存\n              </el-button>\n              <el-button @click=\"resetInfo\">重置</el-button>\n            </el-form-item>\n          </el-form>\n        </el-card>\n\n        <el-card class=\"profile-card\" shadow=\"hover\">\n          <template #header>\n            <span>密码修改</span>\n          </template>\n\n          <el-form\n            ref=\"passwordFormRef\"\n            :model=\"passwordForm\"\n            :rules=\"passwordRules\"\n            label-width=\"110px\"\n            class=\"password-form\"\n          >\n            <el-form-item prop=\"oldPassword\" label=\"当前密码\">\n              <el-input\n                v-model=\"passwordForm.oldPassword\"\n                type=\"password\"\n                autocomplete=\"current-password\"\n                placeholder=\"请输入当前密码\"\n              />\n            </el-form-item>\n            <el-form-item prop=\"newPassword\" label=\"新密码\">\n              <el-input\n                v-model=\"passwordForm.newPassword\"\n                type=\"password\"\n                autocomplete=\"new-password\"\n                placeholder=\"请输入新密码\"\n              />\n            </el-form-item>\n            <el-form-item prop=\"confirmPassword\" label=\"确认新密码\">\n              <el-input\n                v-model=\"passwordForm.confirmPassword\"\n                type=\"password\"\n                autocomplete=\"new-password\"\n                placeholder=\"请再次输入新密码\"\n              />\n            </el-form-item>\n            <el-form-item>\n              <el-button\n                type=\"primary\"\n                :loading=\"passwordLoading\"\n                @click=\"submitPassword\"\n              >\n                修改密码\n              </el-button>\n              <el-button @click=\"resetPasswordForm\">重置</el-button>\n            </el-form-item>\n          </el-form>\n        </el-card>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script setup>\nimport { computed, onMounted, onBeforeUnmount, reactive, ref, watch } from 'vue';\nimport { useStore } from 'vuex';\nimport { ElMessage } from 'element-plus';\nimport { RefreshRight } from '@element-plus/icons-vue';\n\nimport {\n  sanitizeInput,\n  validatePhoneNumber,\n  validatePasswordStrength\n} from '../../utils/security';\nimport SkeletonCard from '../../components/common/SkeletonCard.vue';\n\nconst store = useStore();\n\nconst profile = computed(() => store.getters['user/userProfile'] || {});\nconst roles = computed(() => store.getters['auth/currentUser']?.roles || []);\n\nconst editing = ref(false);\nconst infoLoading = ref(false);\nconst passwordLoading = ref(false);\nconst deviceLoading = ref(false);\nconst draftStorageKey = 'user.profile.draft';\n\nconst infoFormRef = ref();\nconst passwordFormRef = ref();\n\nconst infoForm = reactive({\n  username: '',\n  email: '',\n  phone: '',\n  bio: ''\n});\n\nconst passwordForm = reactive({\n  oldPassword: '',\n  newPassword: '',\n  confirmPassword: ''\n});\n\nconst devices = ref([]);\nconst userLoading = computed(() => store.getters['user/userLoading']);\nconst globalLoading = computed(() => store.getters.globalLoading);\nconst isBusy = computed(() => userLoading.value || globalLoading.value);\n\nconst infoRules = {\n  phone: [\n    {\n      validator: (_, value, callback) => {\n        if (!value) {\n          callback();\n          return;\n        }\n        const sanitized = sanitizeInput(value);\n        if (sanitized !== value) {\n          infoForm.phone = sanitized;\n        }\n        const result = validatePhoneNumber(sanitized);\n        if (result !== true) {\n          callback(new Error(result));\n        } else {\n          callback();\n        }\n      },\n      trigger: ['blur', 'change']\n    }\n  ],\n  bio: [{ min: 0, max: 200, message: '简介内容需少于 200 字', trigger: 'blur' }]\n};\n\nconst passwordRules = {\n  oldPassword: [{ required: true, message: '请输入当前密码', trigger: 'blur' }],\n  newPassword: [\n    { required: true, message: '请输入新密码', trigger: 'blur' },\n    {\n      validator: (_, value, callback) => {\n        const result = validatePasswordStrength(value);\n        if (!result.valid) {\n          callback(new Error(result.feedback[0] || '密码复杂度不足'));\n        } else {\n          callback();\n        }\n      },\n      trigger: 'change'\n    }\n  ],\n  confirmPassword: [\n    { required: true, message: '请确认新密码', trigger: 'blur' },\n    {\n      validator: (_, value, callback) => {\n        if (value !== passwordForm.newPassword) {\n          callback(new Error('两次输入的密码不一致'));\n        } else {\n          callback();\n        }\n      },\n      trigger: ['blur', 'change']\n    }\n  ]\n};\n\nconst initials = computed(() => {\n  const name = infoForm.username || profile.value.username || '';\n  return name.slice(0, 1).toUpperCase();\n});\n\nconst userAvatar = computed(\n  () => profile.value.avatar || store.getters['auth/currentUser']?.avatar\n);\nconst userDisplayName = computed(() => profile.value.username || '未命名用户');\nconst maskedPhone = computed(() => {\n  const phone = profile.value.phone;\n  if (!phone) return '未绑定';\n  return phone.replace(/^(\\d{3})\\d{4}(\\d{4})$/, '$1****$2');\n});\nconst primaryRole = computed(() => roles.value?.[0] || '');\nconst formattedRegisterTime = computed(() =>\n  formatDate(profile.value.createdAt)\n);\nconst latestDeviceTime = computed(() => {\n  if (!devices.value.length) return '暂无记录';\n  return formatRelative(devices.value[0]?.lastActiveAt);\n});\n\nfunction formatDate(value) {\n  if (!value) return '未知';\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) return '未知';\n  return date.toLocaleString();\n}\n\nfunction formatRelative(date) {\n  if (!date) return '未知';\n  const now = Date.now();\n  const diff = now - new Date(date).getTime();\n  if (diff < 0) return '刚刚';\n  const minutes = Math.floor(diff / 60000);\n  if (minutes < 1) return '刚刚';\n  if (minutes < 60) return `${minutes} 分钟前`;\n  const hours = Math.floor(minutes / 60);\n  if (hours < 24) return `${hours} 小时前`;\n  const days = Math.floor(hours / 24);\n  if (days < 7) return `${days} 天前`;\n  return formatDate(date);\n}\n\nfunction fillInfoForm(data) {\n  infoForm.username = data.username || '';\n  infoForm.email = data.email || '';\n  infoForm.phone = data.phone || '';\n  infoForm.bio = data.bio || '';\n}\n\nfunction restoreDraft() {\n  try {\n    const draft = localStorage.getItem(draftStorageKey);\n    if (!draft) return;\n    const parsed = JSON.parse(draft);\n    infoForm.phone = parsed.phone || infoForm.phone;\n    infoForm.bio = parsed.bio || infoForm.bio;\n  } catch (error) {\n    console.warn('读取个人资料草稿失败:', error);\n  }\n}\n\nfunction clearDraft() {\n  localStorage.removeItem(draftStorageKey);\n}\n\nasync function loadProfile(force = false) {\n  try {\n    const data = await store.dispatch('user/fetchProfile', { force });\n    fillInfoForm(data);\n    restoreDraft();\n  } catch (error) {\n    console.error('获取用户信息失败', error);\n  }\n}\n\nasync function loadDevices() {\n  deviceLoading.value = true;\n  try {\n    const data = await store.dispatch('user/fetchDevices');\n    devices.value = data;\n  } catch (error) {\n    console.error('获取设备信息失败', error);\n    devices.value = [];\n  } finally {\n    deviceLoading.value = false;\n  }\n}\n\nfunction toggleEdit() {\n  editing.value = !editing.value;\n  if (!editing.value) {\n    resetInfo();\n    clearDraft();\n  } else {\n    restoreDraft();\n  }\n}\n\nfunction resetInfo() {\n  fillInfoForm(profile.value || {});\n  infoFormRef.value?.clearValidate();\n}\n\nfunction resetPasswordForm() {\n  passwordForm.oldPassword = '';\n  passwordForm.newPassword = '';\n  passwordForm.confirmPassword = '';\n  passwordFormRef.value?.clearValidate();\n}\n\nfunction submitInfo() {\n  if (!infoFormRef.value) return;\n\n  infoFormRef.value.validate(async (valid) => {\n    if (!valid) return;\n    infoLoading.value = true;\n    try {\n      await store.dispatch('user/updateProfile', {\n        phone: sanitizeInput(infoForm.phone),\n        bio: sanitizeInput(infoForm.bio)\n      });\n      await loadProfile(true);\n      ElMessage.success('个人信息已更新');\n      editing.value = false;\n      clearDraft();\n    } catch (error) {\n      ElMessage.error(error?.message || '更新个人信息失败');\n    } finally {\n      infoLoading.value = false;\n    }\n  });\n}\n\nfunction submitPassword() {\n  if (!passwordFormRef.value) return;\n\n  passwordFormRef.value.validate(async (valid) => {\n    if (!valid) return;\n    passwordLoading.value = true;\n    try {\n      await store.dispatch('user/changePassword', {\n        oldPassword: passwordForm.oldPassword,\n        newPassword: passwordForm.newPassword\n      });\n      ElMessage.success('密码修改成功，请使用新密码重新登录');\n      resetPasswordForm();\n    } catch (error) {\n      ElMessage.error(error?.message || '密码修改失败，请稍后再试');\n    } finally {\n      passwordLoading.value = false;\n    }\n  });\n}\n\nonMounted(async () => {\n  if (!profile.value || !Object.keys(profile.value).length) {\n    await loadProfile();\n  } else {\n    fillInfoForm(profile.value);\n    restoreDraft();\n  }\n  await loadDevices();\n});\n\nconst draftFields = computed(() => ({\n  phone: infoForm.phone,\n  bio: infoForm.bio\n}));\n\nlet draftTimer = null;\n\nwatch(\n  [draftFields, editing],\n  ([fields, isEditing]) => {\n    if (!isEditing) return;\n    if (draftTimer) clearTimeout(draftTimer);\n    draftTimer = setTimeout(() => {\n      try {\n        localStorage.setItem(draftStorageKey, JSON.stringify(fields));\n      } catch (error) {\n        console.warn('保存个人资料草稿失败:', error);\n      }\n    }, 500);\n  },\n  { deep: true }\n);\n\nonBeforeUnmount(() => {\n  if (draftTimer) clearTimeout(draftTimer);\n});\n</script>\n\n<style scoped>\n.profile-wrapper {\n  padding: 20px 0 40px;\n}\n\n.profile-skeleton-stack {\n  display: grid;\n  gap: 20px;\n}\n\n.profile-card {\n  margin-bottom: 20px;\n  border-radius: 16px;\n}\n\n.profile-summary {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n\n.summary-info h2 {\n  margin: 0;\n  font-size: 20px;\n  color: #1f2937;\n}\n\n.summary-info p {\n  margin: 6px 0 0;\n  color: #6b7280;\n  font-size: 14px;\n}\n\n.summary-list {\n  list-style: none;\n  margin: 0;\n  padding: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  color: #4b5563;\n  font-size: 14px;\n}\n\n.summary-list li {\n  display: flex;\n  justify-content: space-between;\n}\n\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-weight: 600;\n}\n\n.info-form,\n.password-form {\n  max-width: 520px;\n}\n\n.device-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  gap: 12px;\n}\n\n.devices-card {\n  border-radius: 16px;\n}\n\n@media (max-width: 768px) {\n  .profile-wrapper {\n    padding: 12px 0 24px;\n  }\n\n  .info-form,\n  .password-form {\n    max-width: 100%;\n  }\n}\n</style>\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}