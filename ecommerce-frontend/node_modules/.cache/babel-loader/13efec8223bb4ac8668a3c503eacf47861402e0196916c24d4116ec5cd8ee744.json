{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { computed, onMounted, reactive, ref } from 'vue';\nimport { useRouter, useRoute } from 'vue-router';\nimport { useStore } from 'vuex';\nimport { ElMessage } from 'element-plus';\nimport { UserFilled, Lock } from '@element-plus/icons-vue';\nimport http from '../../services/http';\nimport { sanitizeInput } from '../../utils/security';\nexport default {\n  __name: 'Login',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const formRef = ref();\n    const loading = ref(false);\n    const errorMessage = ref('');\n    const captchaImage = ref('');\n    const store = useStore();\n    const router = useRouter();\n    const route = useRoute();\n    const form = reactive({\n      identifier: '',\n      password: '',\n      captcha: '',\n      rememberMe: false\n    });\n    const rules = {\n      identifier: [{\n        required: true,\n        message: '请输入用户名或邮箱',\n        trigger: 'blur'\n      }, {\n        validator: (_, value, callback) => {\n          const sanitized = sanitizeInput(value);\n          if (sanitized !== value) {\n            form.identifier = sanitized;\n          }\n          callback();\n        },\n        trigger: 'change'\n      }],\n      password: [{\n        required: true,\n        message: '请输入密码',\n        trigger: 'blur'\n      }, {\n        min: 6,\n        message: '密码长度至少 6 位',\n        trigger: 'blur'\n      }],\n      captcha: [{\n        required: true,\n        message: '请输入验证码',\n        trigger: 'blur'\n      }, {\n        len: 6,\n        message: '验证码为 6 位',\n        trigger: 'blur'\n      }]\n    };\n    const redirectPath = computed(() => route.query.redirect || {\n      name: 'Dashboard'\n    });\n    async function refreshCaptcha() {\n      try {\n        const {\n          image,\n          key\n        } = await http.get('/api/v1/public/captcha');\n        captchaImage.value = image;\n        sessionStorage.setItem('auth.captchaKey', key);\n      } catch (error) {\n        captchaImage.value = '';\n        console.warn('获取验证码失败', error);\n      }\n    }\n    function goForgot() {\n      ElMessage.info('请联系管理员或使用后台提供的找回方式。');\n    }\n    function goRegister() {\n      router.push({\n        name: 'Register'\n      });\n    }\n    async function handleSubmit() {\n      if (!formRef.value) return;\n      errorMessage.value = '';\n      formRef.value.validate(async valid => {\n        if (!valid) return;\n        loading.value = true;\n        try {\n          await store.dispatch('auth/login', {\n            identifier: sanitizeInput(form.identifier),\n            password: form.password,\n            captcha: form.captcha,\n            captchaKey: sessionStorage.getItem('auth.captchaKey'),\n            remember: form.rememberMe\n          });\n          ElMessage.success('登录成功');\n          router.replace(redirectPath.value);\n        } catch (error) {\n          if (error?.code === 'AUTH_LOCKED') {\n            errorMessage.value = '账户已锁定，请联系管理员解锁。';\n          } else {\n            errorMessage.value = error?.message || '用户名或密码错误，请重试。';\n          }\n          refreshCaptcha();\n        } finally {\n          loading.value = false;\n        }\n      });\n    }\n    onMounted(() => {\n      const saved = localStorage.getItem('auth.remember');\n      if (saved) {\n        try {\n          const parsed = JSON.parse(saved);\n          form.identifier = parsed.identifier || '';\n          form.rememberMe = true;\n        } catch (error) {\n          console.warn('解析记住的登录信息失败', error);\n        }\n      }\n      refreshCaptcha();\n    });\n    const __returned__ = {\n      formRef,\n      loading,\n      errorMessage,\n      captchaImage,\n      store,\n      router,\n      route,\n      form,\n      rules,\n      redirectPath,\n      refreshCaptcha,\n      goForgot,\n      goRegister,\n      handleSubmit,\n      computed,\n      onMounted,\n      reactive,\n      ref,\n      get useRouter() {\n        return useRouter;\n      },\n      get useRoute() {\n        return useRoute;\n      },\n      get useStore() {\n        return useStore;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get UserFilled() {\n        return UserFilled;\n      },\n      get Lock() {\n        return Lock;\n      },\n      get http() {\n        return http;\n      },\n      get sanitizeInput() {\n        return sanitizeInput;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["computed","onMounted","reactive","ref","useRouter","useRoute","useStore","ElMessage","UserFilled","Lock","http","sanitizeInput","formRef","loading","errorMessage","captchaImage","store","router","route","form","identifier","password","captcha","rememberMe","rules","required","message","trigger","validator","_","value","callback","sanitized","min","len","redirectPath","query","redirect","name","refreshCaptcha","image","key","get","sessionStorage","setItem","error","console","warn","goForgot","info","goRegister","push","handleSubmit","validate","valid","dispatch","captchaKey","getItem","remember","success","replace","code","saved","localStorage","parsed","JSON","parse"],"sources":["C:/Users/Administrator/Desktop/zonshe/ecommerce-frontend/src/pages/auth/Login.vue"],"sourcesContent":["<template>\n  <div class=\"auth-container\">\n    <div class=\"auth-card\">\n      <header class=\"auth-header\">\n        <h1>欢迎回来</h1>\n        <p>请输入账号信息登录系统</p>\n      </header>\n\n      <el-form\n        ref=\"formRef\"\n        :model=\"form\"\n        :rules=\"rules\"\n        status-icon\n        label-position=\"top\"\n        class=\"auth-form\"\n        @keyup.enter=\"handleSubmit\"\n      >\n        <el-form-item prop=\"identifier\" label=\"用户名 / 邮箱\">\n          <el-input\n            v-model.trim=\"form.identifier\"\n            placeholder=\"请输入用户名或邮箱\"\n            autocomplete=\"username\"\n            clearable\n            :disabled=\"loading\"\n          >\n            <template #prepend>\n              <el-icon><UserFilled /></el-icon>\n            </template>\n          </el-input>\n        </el-form-item>\n\n        <el-form-item prop=\"password\" label=\"密码\">\n          <el-input\n            v-model=\"form.password\"\n            placeholder=\"请输入密码\"\n            show-password\n            autocomplete=\"current-password\"\n            :disabled=\"loading\"\n          >\n            <template #prepend>\n              <el-icon><Lock /></el-icon>\n            </template>\n          </el-input>\n        </el-form-item>\n\n        <el-row :gutter=\"12\">\n          <el-col :xs=\"24\" :sm=\"14\">\n            <el-form-item prop=\"captcha\" label=\"验证码\">\n              <el-input\n                v-model.trim=\"form.captcha\"\n                placeholder=\"请输入验证码\"\n                maxlength=\"6\"\n                :disabled=\"loading\"\n              />\n            </el-form-item>\n          </el-col>\n          <el-col :xs=\"24\" :sm=\"10\" class=\"captcha-col\">\n            <el-image\n              class=\"captcha-image\"\n              :src=\"captchaImage\"\n              fit=\"contain\"\n              @click=\"refreshCaptcha\"\n            >\n              <template #error>\n                <div class=\"captcha-placeholder\" @click=\"refreshCaptcha\">\n                  点击刷新验证码\n                </div>\n              </template>\n            </el-image>\n          </el-col>\n        </el-row>\n\n        <div class=\"form-aux\">\n          <el-checkbox v-model=\"form.rememberMe\" :disabled=\"loading\">\n            记住我\n          </el-checkbox>\n\n          <el-link type=\"primary\" :underline=\"false\" @click=\"goForgot\">\n            忘记密码？\n          </el-link>\n        </div>\n\n        <el-alert\n          v-if=\"errorMessage\"\n          class=\"auth-alert\"\n          type=\"error\"\n          show-icon\n          :closable=\"false\"\n          :title=\"errorMessage\"\n        />\n\n        <el-button\n          type=\"primary\"\n          class=\"auth-submit\"\n          :loading=\"loading\"\n          :disabled=\"loading\"\n          @click=\"handleSubmit\"\n        >\n          登录\n        </el-button>\n\n        <div class=\"form-footer\">\n          还没有账号？\n          <el-link type=\"primary\" :underline=\"false\" @click=\"goRegister\">\n            立即注册\n          </el-link>\n        </div>\n      </el-form>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { computed, onMounted, reactive, ref } from 'vue';\nimport { useRouter, useRoute } from 'vue-router';\nimport { useStore } from 'vuex';\nimport { ElMessage } from 'element-plus';\nimport { UserFilled, Lock } from '@element-plus/icons-vue';\n\nimport http from '../../services/http';\nimport { sanitizeInput } from '../../utils/security';\n\nconst formRef = ref();\nconst loading = ref(false);\nconst errorMessage = ref('');\nconst captchaImage = ref('');\n\nconst store = useStore();\nconst router = useRouter();\nconst route = useRoute();\n\nconst form = reactive({\n  identifier: '',\n  password: '',\n  captcha: '',\n  rememberMe: false\n});\n\nconst rules = {\n  identifier: [\n    { required: true, message: '请输入用户名或邮箱', trigger: 'blur' },\n    {\n      validator: (_, value, callback) => {\n        const sanitized = sanitizeInput(value);\n        if (sanitized !== value) {\n          form.identifier = sanitized;\n        }\n        callback();\n      },\n      trigger: 'change'\n    }\n  ],\n  password: [\n    { required: true, message: '请输入密码', trigger: 'blur' },\n    { min: 6, message: '密码长度至少 6 位', trigger: 'blur' }\n  ],\n  captcha: [\n    { required: true, message: '请输入验证码', trigger: 'blur' },\n    { len: 6, message: '验证码为 6 位', trigger: 'blur' }\n  ]\n};\n\nconst redirectPath = computed(() => route.query.redirect || { name: 'Dashboard' });\n\nasync function refreshCaptcha() {\n  try {\n    const { image, key } = await http.get('/api/v1/public/captcha');\n    captchaImage.value = image;\n    sessionStorage.setItem('auth.captchaKey', key);\n  } catch (error) {\n    captchaImage.value = '';\n    console.warn('获取验证码失败', error);\n  }\n}\n\nfunction goForgot() {\n  ElMessage.info('请联系管理员或使用后台提供的找回方式。');\n}\n\nfunction goRegister() {\n  router.push({ name: 'Register' });\n}\n\nasync function handleSubmit() {\n  if (!formRef.value) return;\n\n  errorMessage.value = '';\n\n  formRef.value.validate(async (valid) => {\n    if (!valid) return;\n\n    loading.value = true;\n    try {\n      await store.dispatch('auth/login', {\n        identifier: sanitizeInput(form.identifier),\n        password: form.password,\n        captcha: form.captcha,\n        captchaKey: sessionStorage.getItem('auth.captchaKey'),\n        remember: form.rememberMe\n      });\n\n      ElMessage.success('登录成功');\n      router.replace(redirectPath.value);\n    } catch (error) {\n      if (error?.code === 'AUTH_LOCKED') {\n        errorMessage.value = '账户已锁定，请联系管理员解锁。';\n      } else {\n        errorMessage.value =\n          error?.message || '用户名或密码错误，请重试。';\n      }\n      refreshCaptcha();\n    } finally {\n      loading.value = false;\n    }\n  });\n}\n\nonMounted(() => {\n  const saved = localStorage.getItem('auth.remember');\n  if (saved) {\n    try {\n      const parsed = JSON.parse(saved);\n      form.identifier = parsed.identifier || '';\n      form.rememberMe = true;\n    } catch (error) {\n      console.warn('解析记住的登录信息失败', error);\n    }\n  }\n  refreshCaptcha();\n});\n</script>\n\n<style scoped>\n.auth-container {\n  min-height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #f0f5ff 0%, #fefefe 100%);\n  padding: 24px;\n}\n\n.auth-card {\n  width: 100%;\n  max-width: 420px;\n  background: #fff;\n  border-radius: 16px;\n  padding: 32px 36px;\n  box-shadow: 0 20px 40px -24px rgba(59, 87, 255, 0.45);\n}\n\n.auth-header {\n  text-align: center;\n  margin-bottom: 24px;\n}\n\n.auth-header h1 {\n  margin: 0;\n  font-size: 26px;\n  color: #1f2937;\n}\n\n.auth-header p {\n  margin: 8px 0 0;\n  color: #6b7280;\n  font-size: 14px;\n}\n\n.auth-form {\n  display: flex;\n  flex-direction: column;\n}\n\n.form-aux {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 16px;\n}\n\n.auth-alert {\n  margin-bottom: 16px;\n}\n\n.auth-submit {\n  width: 100%;\n  height: 44px;\n  font-size: 16px;\n  margin-bottom: 12px;\n}\n\n.form-footer {\n  text-align: center;\n  color: #6b7280;\n  font-size: 14px;\n}\n\n.captcha-col {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.captcha-image {\n  width: 100%;\n  height: 46px;\n  border-radius: 8px;\n  cursor: pointer;\n  border: 1px solid #e5e7eb;\n}\n\n.captcha-placeholder {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 12px;\n  color: #6b7280;\n  background-color: #f3f4f6;\n  border-radius: 8px;\n}\n\n@media (max-width: 600px) {\n  .auth-card {\n    padding: 24px;\n    border-radius: 12px;\n  }\n\n  .form-aux {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 8px;\n  }\n\n  .captcha-col {\n    margin-top: 4px;\n  }\n}\n</style>\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}