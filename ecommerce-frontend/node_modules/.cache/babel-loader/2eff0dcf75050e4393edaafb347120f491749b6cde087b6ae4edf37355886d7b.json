{"ast":null,"code":"import axios from 'axios';\nimport http, { API_BASE_URL, normalizeHttpError } from '../http';\nconst AUTH_PREFIX = '/api/v1/user';\nconst CSRF_STORAGE_KEY = 'auth.csrfToken';\nexport async function login(credentials) {\n  const payload = normalizeLoginPayload(credentials);\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/login`, payload, {\n      skipAuthRefresh: true\n    });\n    return normalizeAuthResponse(data);\n  } catch (error) {\n    const normalized = normalizeAuthError(error);\n    throw normalized;\n  }\n}\nexport async function register(payload) {\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/register`, payload, {\n      skipAuthRefresh: true\n    });\n    return normalizeAuthResponse(data);\n  } catch (error) {\n    throw normalizeHttpError(error, '注册失败，请稍后再试。');\n  }\n}\nexport async function logout() {\n  try {\n    await http.post(`${AUTH_PREFIX}/logout`);\n  } catch (error) {\n    throw normalizeHttpError(error, '退出登录失败，请稍后再试。');\n  }\n  localStorage.removeItem(CSRF_STORAGE_KEY);\n}\nexport async function refreshToken(refreshToken) {\n  try {\n    const response = await axios.post(`${API_BASE_URL}${AUTH_PREFIX}/token/refresh`, {\n      refreshToken\n    }, {\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      timeout: 8000\n    });\n    return normalizeAuthResponse(response.data);\n  } catch (error) {\n    throw normalizeHttpError(error, '刷新登录状态失败，请重新登录。');\n  }\n}\nfunction normalizeAuthResponse(data = {}) {\n  const payload = data && typeof data === 'object' && typeof data.data === 'object' ? data.data : data;\n  const token = payload.token || payload.accessToken || payload.access_token || data.token || null;\n  const refreshToken = payload.refreshToken || payload.refresh_token || data.refreshToken || null;\n  const expiresIn = payload.expiresIn || payload.expires_in || data.expiresIn || null;\n  const csrfToken = payload.csrfToken || payload.csrf_token || data.csrfToken || null;\n  const user = payload.user || data.user || null;\n  const expiresAt = payload.expiresAt ? Number(payload.expiresAt) : expiresIn ? Date.now() + Number(expiresIn) * 1000 : null;\n  if (csrfToken) {\n    try {\n      localStorage.setItem(CSRF_STORAGE_KEY, csrfToken);\n    } catch (error) {\n      console.warn('[authAPI] 存储 CSRF 令牌失败:', error);\n    }\n  }\n  return {\n    token,\n    refreshToken,\n    expiresAt,\n    user,\n    raw: data\n  };\n}\nfunction normalizeLoginPayload(credentials = {}) {\n  const payload = {\n    ...credentials\n  };\n  if (payload.identifier && !payload.username) {\n    payload.username = payload.identifier;\n  }\n  delete payload.identifier;\n  delete payload.remember;\n  return payload;\n}\nfunction normalizeAuthError(error) {\n  const normalized = normalizeHttpError(error, '登录失败，请检查账号信息。');\n  if (normalized.status === 401) {\n    normalized.message = '用户名或密码错误，请重试。';\n  }\n  return normalized;\n}\nexport default {\n  login,\n  register,\n  logout,\n  refreshToken\n};","map":{"version":3,"names":["axios","http","API_BASE_URL","normalizeHttpError","AUTH_PREFIX","CSRF_STORAGE_KEY","login","credentials","payload","normalizeLoginPayload","data","post","skipAuthRefresh","normalizeAuthResponse","error","normalized","normalizeAuthError","register","logout","localStorage","removeItem","refreshToken","response","headers","timeout","token","accessToken","access_token","refresh_token","expiresIn","expires_in","csrfToken","csrf_token","user","expiresAt","Number","Date","now","setItem","console","warn","raw","identifier","username","remember","status","message"],"sources":["C:/Users/Administrator/Desktop/zonshe/ecommerce-frontend/src/services/api/authAPI.js"],"sourcesContent":["import axios from 'axios';\nimport http, { API_BASE_URL, normalizeHttpError } from '../http';\n\nconst AUTH_PREFIX = '/api/v1/user';\nconst CSRF_STORAGE_KEY = 'auth.csrfToken';\n\nexport async function login(credentials) {\n  const payload = normalizeLoginPayload(credentials);\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/login`, payload, {\n      skipAuthRefresh: true\n    });\n    return normalizeAuthResponse(data);\n  } catch (error) {\n    const normalized = normalizeAuthError(error);\n    throw normalized;\n  }\n}\n\nexport async function register(payload) {\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/register`, payload, {\n      skipAuthRefresh: true\n    });\n    return normalizeAuthResponse(data);\n  } catch (error) {\n    throw normalizeHttpError(error, '注册失败，请稍后再试。');\n  }\n}\n\nexport async function logout() {\n  try {\n    await http.post(`${AUTH_PREFIX}/logout`);\n  } catch (error) {\n    throw normalizeHttpError(error, '退出登录失败，请稍后再试。');\n  }\n  localStorage.removeItem(CSRF_STORAGE_KEY);\n}\n\nexport async function refreshToken(refreshToken) {\n  try {\n    const response = await axios.post(\n      `${API_BASE_URL}${AUTH_PREFIX}/token/refresh`,\n      { refreshToken },\n      {\n        headers: { 'Content-Type': 'application/json' },\n        timeout: 8000\n      }\n    );\n    return normalizeAuthResponse(response.data);\n  } catch (error) {\n    throw normalizeHttpError(error, '刷新登录状态失败，请重新登录。');\n  }\n}\n\nfunction normalizeAuthResponse(data = {}) {\n  const payload =\n    data && typeof data === 'object' && typeof data.data === 'object'\n      ? data.data\n      : data;\n\n  const token =\n    payload.token ||\n    payload.accessToken ||\n    payload.access_token ||\n    data.token ||\n    null;\n  const refreshToken =\n    payload.refreshToken ||\n    payload.refresh_token ||\n    data.refreshToken ||\n    null;\n  const expiresIn =\n    payload.expiresIn ||\n    payload.expires_in ||\n    data.expiresIn ||\n    null;\n  const csrfToken =\n    payload.csrfToken || payload.csrf_token || data.csrfToken || null;\n  const user = payload.user || data.user || null;\n\n  const expiresAt = payload.expiresAt\n    ? Number(payload.expiresAt)\n    : expiresIn\n      ? Date.now() + Number(expiresIn) * 1000\n      : null;\n\n  if (csrfToken) {\n    try {\n      localStorage.setItem(CSRF_STORAGE_KEY, csrfToken);\n    } catch (error) {\n      console.warn('[authAPI] 存储 CSRF 令牌失败:', error);\n    }\n  }\n  return {\n    token,\n    refreshToken,\n    expiresAt,\n    user,\n    raw: data\n  };\n}\n\nfunction normalizeLoginPayload(credentials = {}) {\n  const payload = { ...credentials };\n  if (payload.identifier && !payload.username) {\n    payload.username = payload.identifier;\n  }\n  delete payload.identifier;\n  delete payload.remember;\n  return payload;\n}\n\nfunction normalizeAuthError(error) {\n  const normalized = normalizeHttpError(error, '登录失败，请检查账号信息。');\n  if (normalized.status === 401) {\n    normalized.message = '用户名或密码错误，请重试。';\n  }\n  return normalized;\n}\n\nexport default {\n  login,\n  register,\n  logout,\n  refreshToken\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}