{"ast":null,"code":"import axios from 'axios';\nimport http, { API_BASE_URL, normalizeHttpError } from '../http';\nconst AUTH_PREFIX = '/api/v1/user';\nconst CSRF_STORAGE_KEY = 'auth.csrfToken';\nexport async function login(credentials) {\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/login`, credentials);\n    return normalizeAuthResponse(data);\n  } catch (error) {\n    throw normalizeHttpError(error, '登录失败，请检查账号信息。');\n  }\n}\nexport async function register(payload) {\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/register`, payload);\n    return normalizeAuthResponse(data);\n  } catch (error) {\n    throw normalizeHttpError(error, '注册失败，请稍后再试。');\n  }\n}\nexport async function logout() {\n  try {\n    await http.post(`${AUTH_PREFIX}/logout`);\n  } catch (error) {\n    throw normalizeHttpError(error, '退出登录失败，请稍后再试。');\n  }\n  localStorage.removeItem(CSRF_STORAGE_KEY);\n}\nexport async function refreshToken(refreshToken) {\n  try {\n    const response = await axios.post(`${API_BASE_URL}${AUTH_PREFIX}/token/refresh`, {\n      refreshToken\n    }, {\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      timeout: 8000\n    });\n    return normalizeAuthResponse(response.data);\n  } catch (error) {\n    throw normalizeHttpError(error, '刷新登录状态失败，请重新登录。');\n  }\n}\nfunction normalizeAuthResponse(data = {}) {\n  const {\n    token,\n    refreshToken,\n    expiresIn,\n    user,\n    csrfToken,\n    ...rest\n  } = data;\n  const expiresAt = expiresIn ? Date.now() + Number(expiresIn) * 1000 : null;\n  if (csrfToken) {\n    try {\n      localStorage.setItem(CSRF_STORAGE_KEY, csrfToken);\n    } catch (error) {\n      console.warn('[authAPI] 存储 CSRF 令牌失败:', error);\n    }\n  }\n  return {\n    token,\n    refreshToken,\n    expiresAt,\n    user: user || null,\n    raw: rest\n  };\n}\nexport default {\n  login,\n  register,\n  logout,\n  refreshToken\n};","map":{"version":3,"names":["axios","http","API_BASE_URL","normalizeHttpError","AUTH_PREFIX","CSRF_STORAGE_KEY","login","credentials","data","post","normalizeAuthResponse","error","register","payload","logout","localStorage","removeItem","refreshToken","response","headers","timeout","token","expiresIn","user","csrfToken","rest","expiresAt","Date","now","Number","setItem","console","warn","raw"],"sources":["C:/Users/Administrator/Desktop/zonshe/ecommerce-frontend/src/services/api/authAPI.js"],"sourcesContent":["import axios from 'axios';\nimport http, { API_BASE_URL, normalizeHttpError } from '../http';\n\nconst AUTH_PREFIX = '/api/v1/user';\nconst CSRF_STORAGE_KEY = 'auth.csrfToken';\n\nexport async function login(credentials) {\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/login`, credentials);\n    return normalizeAuthResponse(data);\n  } catch (error) {\n    throw normalizeHttpError(error, '登录失败，请检查账号信息。');\n  }\n}\n\nexport async function register(payload) {\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/register`, payload);\n    return normalizeAuthResponse(data);\n  } catch (error) {\n    throw normalizeHttpError(error, '注册失败，请稍后再试。');\n  }\n}\n\nexport async function logout() {\n  try {\n    await http.post(`${AUTH_PREFIX}/logout`);\n  } catch (error) {\n    throw normalizeHttpError(error, '退出登录失败，请稍后再试。');\n  }\n  localStorage.removeItem(CSRF_STORAGE_KEY);\n}\n\nexport async function refreshToken(refreshToken) {\n  try {\n    const response = await axios.post(\n      `${API_BASE_URL}${AUTH_PREFIX}/token/refresh`,\n      { refreshToken },\n      {\n        headers: { 'Content-Type': 'application/json' },\n        timeout: 8000\n      }\n    );\n    return normalizeAuthResponse(response.data);\n  } catch (error) {\n    throw normalizeHttpError(error, '刷新登录状态失败，请重新登录。');\n  }\n}\n\nfunction normalizeAuthResponse(data = {}) {\n  const { token, refreshToken, expiresIn, user, csrfToken, ...rest } = data;\n  const expiresAt = expiresIn ? Date.now() + Number(expiresIn) * 1000 : null;\n  if (csrfToken) {\n    try {\n      localStorage.setItem(CSRF_STORAGE_KEY, csrfToken);\n    } catch (error) {\n      console.warn('[authAPI] 存储 CSRF 令牌失败:', error);\n    }\n  }\n  return {\n    token,\n    refreshToken,\n    expiresAt,\n    user: user || null,\n    raw: rest\n  };\n}\n\nexport default {\n  login,\n  register,\n  logout,\n  refreshToken\n};\n\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,IAAI,IAAIC,YAAY,EAAEC,kBAAkB,QAAQ,SAAS;AAEhE,MAAMC,WAAW,GAAG,cAAc;AAClC,MAAMC,gBAAgB,GAAG,gBAAgB;AAEzC,OAAO,eAAeC,KAAKA,CAACC,WAAW,EAAE;EACvC,IAAI;IACF,MAAMC,IAAI,GAAG,MAAMP,IAAI,CAACQ,IAAI,CAAC,GAAGL,WAAW,QAAQ,EAAEG,WAAW,CAAC;IACjE,OAAOG,qBAAqB,CAACF,IAAI,CAAC;EACpC,CAAC,CAAC,OAAOG,KAAK,EAAE;IACd,MAAMR,kBAAkB,CAACQ,KAAK,EAAE,eAAe,CAAC;EAClD;AACF;AAEA,OAAO,eAAeC,QAAQA,CAACC,OAAO,EAAE;EACtC,IAAI;IACF,MAAML,IAAI,GAAG,MAAMP,IAAI,CAACQ,IAAI,CAAC,GAAGL,WAAW,WAAW,EAAES,OAAO,CAAC;IAChE,OAAOH,qBAAqB,CAACF,IAAI,CAAC;EACpC,CAAC,CAAC,OAAOG,KAAK,EAAE;IACd,MAAMR,kBAAkB,CAACQ,KAAK,EAAE,aAAa,CAAC;EAChD;AACF;AAEA,OAAO,eAAeG,MAAMA,CAAA,EAAG;EAC7B,IAAI;IACF,MAAMb,IAAI,CAACQ,IAAI,CAAC,GAAGL,WAAW,SAAS,CAAC;EAC1C,CAAC,CAAC,OAAOO,KAAK,EAAE;IACd,MAAMR,kBAAkB,CAACQ,KAAK,EAAE,eAAe,CAAC;EAClD;EACAI,YAAY,CAACC,UAAU,CAACX,gBAAgB,CAAC;AAC3C;AAEA,OAAO,eAAeY,YAAYA,CAACA,YAAY,EAAE;EAC/C,IAAI;IACF,MAAMC,QAAQ,GAAG,MAAMlB,KAAK,CAACS,IAAI,CAC/B,GAAGP,YAAY,GAAGE,WAAW,gBAAgB,EAC7C;MAAEa;IAAa,CAAC,EAChB;MACEE,OAAO,EAAE;QAAE,cAAc,EAAE;MAAmB,CAAC;MAC/CC,OAAO,EAAE;IACX,CACF,CAAC;IACD,OAAOV,qBAAqB,CAACQ,QAAQ,CAACV,IAAI,CAAC;EAC7C,CAAC,CAAC,OAAOG,KAAK,EAAE;IACd,MAAMR,kBAAkB,CAACQ,KAAK,EAAE,iBAAiB,CAAC;EACpD;AACF;AAEA,SAASD,qBAAqBA,CAACF,IAAI,GAAG,CAAC,CAAC,EAAE;EACxC,MAAM;IAAEa,KAAK;IAAEJ,YAAY;IAAEK,SAAS;IAAEC,IAAI;IAAEC,SAAS;IAAE,GAAGC;EAAK,CAAC,GAAGjB,IAAI;EACzE,MAAMkB,SAAS,GAAGJ,SAAS,GAAGK,IAAI,CAACC,GAAG,CAAC,CAAC,GAAGC,MAAM,CAACP,SAAS,CAAC,GAAG,IAAI,GAAG,IAAI;EAC1E,IAAIE,SAAS,EAAE;IACb,IAAI;MACFT,YAAY,CAACe,OAAO,CAACzB,gBAAgB,EAAEmB,SAAS,CAAC;IACnD,CAAC,CAAC,OAAOb,KAAK,EAAE;MACdoB,OAAO,CAACC,IAAI,CAAC,yBAAyB,EAAErB,KAAK,CAAC;IAChD;EACF;EACA,OAAO;IACLU,KAAK;IACLJ,YAAY;IACZS,SAAS;IACTH,IAAI,EAAEA,IAAI,IAAI,IAAI;IAClBU,GAAG,EAAER;EACP,CAAC;AACH;AAEA,eAAe;EACbnB,KAAK;EACLM,QAAQ;EACRE,MAAM;EACNG;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}