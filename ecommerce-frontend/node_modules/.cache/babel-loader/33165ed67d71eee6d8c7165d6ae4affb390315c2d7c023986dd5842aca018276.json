{"ast":null,"code":"import axios from 'axios';\nimport http, { API_BASE_URL, normalizeHttpError } from '../http';\nconst AUTH_PREFIX = '/api/v1/user';\nconst CSRF_STORAGE_KEY = 'auth.csrfToken';\nexport async function login(credentials) {\n  const payload = normalizeLoginPayload(credentials);\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/login`, payload, {\n      skipAuthRefresh: true,\n      suppressErrorEvent: true\n    });\n    return normalizeAuthResponse(data, {\n      username: payload.username,\n      role: data?.data?.role || data?.role || null\n    });\n  } catch (error) {\n    const normalized = normalizeAuthError(error);\n    throw normalized;\n  }\n}\nexport async function register(payload) {\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/register`, payload, {\n      skipAuthRefresh: true\n    });\n    return normalizeAuthResponse(data, {\n      username: payload.username,\n      phone: payload.phone,\n      email: payload.email\n    });\n  } catch (error) {\n    throw normalizeHttpError(error, '注册失败，请稍后再试。');\n  }\n}\nexport async function logout() {\n  try {\n    await http.post(`${AUTH_PREFIX}/logout`);\n  } catch (error) {\n    throw normalizeHttpError(error, '退出登录失败，请稍后再试。');\n  }\n  localStorage.removeItem(CSRF_STORAGE_KEY);\n}\nexport async function refreshToken(refreshToken) {\n  try {\n    const response = await axios.post(`${API_BASE_URL}${AUTH_PREFIX}/token/refresh`, {\n      refreshToken\n    }, {\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      timeout: 8000\n    });\n    return normalizeAuthResponse(response.data);\n  } catch (error) {\n    throw normalizeHttpError(error, '刷新登录状态失败，请重新登录。');\n  }\n}\nfunction normalizeAuthResponse(data = {}, meta = {}) {\n  const payload = data && typeof data === 'object' && typeof data.data === 'object' ? data.data : data;\n  const token = payload.token || payload.accessToken || payload.access_token || data.token || null;\n  const refreshToken = payload.refreshToken || payload.refresh_token || data.refreshToken || null;\n  const expiresIn = payload.expiresIn || payload.expires_in || data.expiresIn || null;\n  const csrfToken = payload.csrfToken || payload.csrf_token || data.csrfToken || null;\n  const inferredUser = payload.user || data.user || meta.user || (meta.username || payload.username || data.username || meta.email || payload.email ? {\n    username: meta.username || payload.username || data.username || null,\n    role: meta.role || payload.role || data.role || null,\n    phone: meta.phone || payload.phone || data.phone || null,\n    email: meta.email || payload.email || data.email || null\n  } : null);\n  const expiresAt = payload.expiresAt ? Number(payload.expiresAt) : expiresIn ? Date.now() + Number(expiresIn) * 1000 : null;\n  if (csrfToken) {\n    try {\n      localStorage.setItem(CSRF_STORAGE_KEY, csrfToken);\n    } catch (error) {\n      console.warn('[authAPI] 存储 CSRF 令牌失败:', error);\n    }\n  }\n  return {\n    token,\n    refreshToken,\n    expiresAt,\n    user: inferredUser,\n    raw: data\n  };\n}\nfunction normalizeLoginPayload(credentials = {}) {\n  const payload = {\n    ...credentials\n  };\n  if (payload.identifier && !payload.username) {\n    payload.username = payload.identifier;\n  }\n  delete payload.identifier;\n  delete payload.remember;\n  return payload;\n}\nfunction normalizeAuthError(error) {\n  const normalized = normalizeHttpError(error, '登录失败，请检查账号信息。');\n  if (normalized.status === 401) {\n    normalized.message = '用户名或密码错误，请重试。';\n  }\n  return normalized;\n}\nexport default {\n  login,\n  register,\n  logout,\n  refreshToken\n};","map":{"version":3,"names":["axios","http","API_BASE_URL","normalizeHttpError","AUTH_PREFIX","CSRF_STORAGE_KEY","login","credentials","payload","normalizeLoginPayload","data","post","skipAuthRefresh","suppressErrorEvent","normalizeAuthResponse","username","role","error","normalized","normalizeAuthError","register","phone","email","logout","localStorage","removeItem","refreshToken","response","headers","timeout","meta","token","accessToken","access_token","refresh_token","expiresIn","expires_in","csrfToken","csrf_token","inferredUser","user","expiresAt","Number","Date","now","setItem","console","warn","raw","identifier","remember","status","message"],"sources":["C:/Users/Administrator/Desktop/zonshe/ecommerce-frontend/src/services/api/authAPI.js"],"sourcesContent":["import axios from 'axios';\nimport http, { API_BASE_URL, normalizeHttpError } from '../http';\n\nconst AUTH_PREFIX = '/api/v1/user';\nconst CSRF_STORAGE_KEY = 'auth.csrfToken';\n\nexport async function login(credentials) {\n  const payload = normalizeLoginPayload(credentials);\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/login`, payload, {\n      skipAuthRefresh: true,\n      suppressErrorEvent: true\n    });\n    return normalizeAuthResponse(data, {\n      username: payload.username,\n      role:\n        data?.data?.role ||\n        data?.role ||\n        null\n    });\n  } catch (error) {\n    const normalized = normalizeAuthError(error);\n    throw normalized;\n  }\n}\n\nexport async function register(payload) {\n  try {\n    const data = await http.post(`${AUTH_PREFIX}/register`, payload, {\n      skipAuthRefresh: true\n    });\n    return normalizeAuthResponse(data, {\n      username: payload.username,\n      phone: payload.phone,\n      email: payload.email\n    });\n  } catch (error) {\n    throw normalizeHttpError(error, '注册失败，请稍后再试。');\n  }\n}\n\nexport async function logout() {\n  try {\n    await http.post(`${AUTH_PREFIX}/logout`);\n  } catch (error) {\n    throw normalizeHttpError(error, '退出登录失败，请稍后再试。');\n  }\n  localStorage.removeItem(CSRF_STORAGE_KEY);\n}\n\nexport async function refreshToken(refreshToken) {\n  try {\n    const response = await axios.post(\n      `${API_BASE_URL}${AUTH_PREFIX}/token/refresh`,\n      { refreshToken },\n      {\n        headers: { 'Content-Type': 'application/json' },\n        timeout: 8000\n      }\n    );\n    return normalizeAuthResponse(response.data);\n  } catch (error) {\n    throw normalizeHttpError(error, '刷新登录状态失败，请重新登录。');\n  }\n}\n\nfunction normalizeAuthResponse(data = {}, meta = {}) {\n  const payload =\n    data && typeof data === 'object' && typeof data.data === 'object'\n      ? data.data\n      : data;\n\n  const token =\n    payload.token ||\n    payload.accessToken ||\n    payload.access_token ||\n    data.token ||\n    null;\n  const refreshToken =\n    payload.refreshToken ||\n    payload.refresh_token ||\n    data.refreshToken ||\n    null;\n  const expiresIn =\n    payload.expiresIn ||\n    payload.expires_in ||\n    data.expiresIn ||\n    null;\n  const csrfToken =\n    payload.csrfToken || payload.csrf_token || data.csrfToken || null;\n  const inferredUser =\n    payload.user ||\n    data.user ||\n    meta.user ||\n    (meta.username ||\n    payload.username ||\n    data.username ||\n    meta.email ||\n    payload.email\n      ? {\n          username:\n            meta.username || payload.username || data.username || null,\n          role: meta.role || payload.role || data.role || null,\n          phone: meta.phone || payload.phone || data.phone || null,\n          email: meta.email || payload.email || data.email || null\n        }\n      : null);\n\n  const expiresAt = payload.expiresAt\n    ? Number(payload.expiresAt)\n    : expiresIn\n      ? Date.now() + Number(expiresIn) * 1000\n      : null;\n\n  if (csrfToken) {\n    try {\n      localStorage.setItem(CSRF_STORAGE_KEY, csrfToken);\n    } catch (error) {\n      console.warn('[authAPI] 存储 CSRF 令牌失败:', error);\n    }\n  }\n  return {\n    token,\n    refreshToken,\n    expiresAt,\n    user: inferredUser,\n    raw: data\n  };\n}\n\nfunction normalizeLoginPayload(credentials = {}) {\n  const payload = { ...credentials };\n  if (payload.identifier && !payload.username) {\n    payload.username = payload.identifier;\n  }\n  delete payload.identifier;\n  delete payload.remember;\n  return payload;\n}\n\nfunction normalizeAuthError(error) {\n  const normalized = normalizeHttpError(error, '登录失败，请检查账号信息。');\n  if (normalized.status === 401) {\n    normalized.message = '用户名或密码错误，请重试。';\n  }\n  return normalized;\n}\n\nexport default {\n  login,\n  register,\n  logout,\n  refreshToken\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}